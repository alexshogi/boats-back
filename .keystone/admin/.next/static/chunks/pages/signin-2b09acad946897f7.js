(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[176],{1335:function(e,t,n){"use strict";n.d(t,{S:function(){return SigninContainer},u:function(){return useRedirect}});var i=n(5445),a=n(1511),u=n(2784);let SigninContainer=({children:e,title:t})=>{let{colors:n,shadow:u}=(0,i.Fg)();return(0,i.tZ)("div",null,(0,i.tZ)(a.Fb,null,(0,i.tZ)("title",null,t||"Keystone")),(0,i.tZ)(i.M5,{css:{minWidth:"100vw",minHeight:"100vh",backgroundColor:n.backgroundMuted},rounding:"medium"},(0,i.tZ)(i.xu,{css:{background:n.background,width:600,boxShadow:u.s100},margin:"medium",padding:"xlarge",rounding:"medium"},e)))};function useRedirect(){return(0,u.useMemo)(()=>"/",[])}},4176:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/signin",function(){return n(633)}])},633:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h}});var i,a=n(2784),u=n(5445),r=n(5631),s=n(2445),o=n(3900),d=n(81),l=n(3379),c=n(5360),g=n(1511),m=n(1335);let SigninPage=({identityField:e,secretField:t,mutationName:n,successTypename:i,failureTypename:h})=>{var v,f;let p=d.Ps`
    mutation($identity: String!, $secret: String!) {
      authenticate: ${n}(${e}: $identity, ${t}: $secret) {
        ... on ${i} {
          item {
            id
          }
        }
        ... on ${h} {
          message
        }
      }
    }
  `,[w,y]=(0,a.useState)("signin"),[Z,S]=(0,a.useState)({identity:"",secret:""}),[b,_]=(0,a.useState)(!1),k=(0,a.useRef)(null);(0,a.useEffect)(()=>{var e;null===(e=k.current)||void 0===e||e.focus()},[w]);let[E,{error:$,loading:C,data:F}]=(0,l.D)(p),P=(0,c.Mz)(),x=(0,g.tv)(),q=(0,c.gS)(),K=(0,m.u)();(0,a.useEffect)(()=>{b||"authenticated"!==q.authenticatedItem.state||x.push(K)},[q.authenticatedItem,x,K,b]),(0,a.useEffect)(()=>{var e,t;if(b){if((null===(e=q.adminMeta)||void 0===e?void 0:null===(t=e.error)||void 0===t?void 0:t.message)==="Access denied"){x.push("/no-access");return}x.push(K)}},[q.adminMeta,x,K,b]);let onSubmit=async e=>{if(e.preventDefault(),"signin"===w){try{var t;let{data:e}=await E({variables:{identity:Z.identity,secret:Z.secret}});if((null===(t=e.authenticate)||void 0===t?void 0:t.__typename)!==i)return}catch(e){console.error(e);return}await P(),_(!0)}};return(0,u.tZ)(m.S,{title:"Keystone - Sign in"},(0,u.tZ)(u.Kq,{gap:"xlarge",as:"form",onSubmit:onSubmit},(0,u.tZ)(u.H1,null,"Sign In"),$&&(0,u.tZ)(o.qX,{title:"Error",tone:"negative"},$.message),(null==F?void 0:null===(v=F.authenticate)||void 0===v?void 0:v.__typename)===h&&(0,u.tZ)(o.qX,{title:"Error",tone:"negative"},null==F?void 0:F.authenticate.message),(0,u.tZ)(u.Kq,{gap:"medium"},(0,u.tZ)(u.TX,{as:"label",htmlFor:"identity"},e),(0,u.tZ)(s.oi,{id:"identity",name:"identity",value:Z.identity,onChange:e=>S({...Z,identity:e.target.value}),placeholder:e,ref:k}),"signin"===w&&(0,u.tZ)(a.Fragment,null,(0,u.tZ)(u.TX,{as:"label",htmlFor:"password"},t),(0,u.tZ)(s.oi,{id:"password",name:"password",value:Z.secret,onChange:e=>S({...Z,secret:e.target.value}),placeholder:t,type:"password"}))),"forgot password"===w?(0,u.tZ)(u.Kq,{gap:"medium",across:!0},(0,u.tZ)(r.zx,{type:"submit",weight:"bold",tone:"active"},"Log reset link"),(0,u.tZ)(r.zx,{weight:"none",tone:"active",onClick:()=>y("signin")},"Go back")):(0,u.tZ)(u.Kq,{gap:"medium",across:!0},(0,u.tZ)(r.zx,{weight:"bold",tone:"active",isLoading:C||(null==F?void 0:null===(f=F.authenticate)||void 0===f?void 0:f.__typename)===i,type:"submit"},"Sign in"))))};var h=(i={identityField:"email",secretField:"password",mutationName:"authenticateUserWithPassword",successTypename:"UserAuthenticationWithPasswordSuccess",failureTypename:"UserAuthenticationWithPasswordFailure"},()=>(0,u.tZ)(SigninPage,i))}},function(e){e.O(0,[888,774,179],function(){return e(e.s=4176)}),_N_E=e.O()}]);