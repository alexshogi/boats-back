"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{2054:function(e,t,l){l.d(t,{d:function(){return getListPage}});var i=l(7896),r=l(2784),o=l(5631),n=l(5445),a=l(2445),s=l(8344),d=l(6759),u=l(8999),c=l(5364),g=l(8914),p=l(1054);l(4163);var f=l(928);l(9378);var m=l(81),h=l(794),b=l(3379),Z=l(6042);l(7595),l(9097);var y=l(5360),v=l(5632),k=l(487);l(891);var S=l(5273),C=l(1511);l(6987);var x=l(8023),w=l(8346),$=l(3818),F=l(5540),R=l(7035),I=l(5934),P=l(3028),N=l(9740),z=l(6729),q=l(4255),L=l(8580);let M=["selectProps"],O=["components"],CheckMark=e=>{let{isDisabled:t,isFocused:l,isSelected:i}=e,r=(0,a.sF)({size:"medium",type:"radio"});return(0,n.tZ)("div",{className:`${t?"disabled ":""}${l?"focus ":""}${i?"selected":""}`,css:{alignItems:"center",backgroundColor:r.background,borderColor:r.borderColor,borderRadius:r.borderRadius,borderStyle:"solid",borderWidth:r.borderWidth,boxSizing:"border-box",color:r.foreground,cursor:"pointer",display:"flex",flexShrink:0,height:r.boxSize,justifyContent:"center",transition:r.transition,width:r.boxSize,"&.focus":{backgroundColor:r.focus.background,borderColor:r.focus.borderColor,boxShadow:r.focus.shadow,color:r.focus.foreground},"&.selected":{backgroundColor:r.selected.background,borderColor:r.selected.borderColor,boxShadow:r.selected.shadow,color:r.selected.foreground},"&.disabled":{backgroundColor:r.disabled.background,borderColor:r.disabled.borderColor,boxShadow:r.disabled.shadow,color:r.disabled.background,cursor:"default"},"&.selected.disabled":{color:r.disabled.foreground}}},(0,n.tZ)(z.n,{size:"small"}))},OptionPrimitive=e=>{let{children:t,isDisabled:l,isFocused:r,innerProps:o,innerRef:a,className:s}=e,d=(0,n.Fg)();return(0,n.tZ)("div",(0,i.Z)({ref:a,className:s,css:{alignItems:"center",color:l?d.colors.foregroundDim:r?d.colors.linkHoverColor:void 0,cursor:"pointer",display:"flex",fontSize:"0.9em",fontWeight:500,justifyContent:"space-between",background:r?d.colors.backgroundHover:void 0,outline:0,padding:`${d.spacing.small}px`,pointerEvents:l?"none":void 0,"&:not(:first-of-type)":{borderTop:`1px solid ${d.colors.backgroundDim}`},":hover":{background:d.colors.backgroundHover,color:d.colors.linkHoverColor}}},o),t)},T={Control:e=>{let{selectProps:t}=e,l=(0,N.Z)(e,M);return(0,n.tZ)(q.c.Control,(0,i.Z)({selectProps:t},l))},Option:OptionPrimitive,DropdownIndicator:null,IndicatorSeparator:null},Options=e=>{let{components:t}=e,l=(0,N.Z)(e,O),o=(0,r.useMemo)(()=>(0,P.Z)((0,P.Z)({},T),t),[t]),a=(0,n.Fg)(),s=(0,r.useMemo)(()=>({control:e=>(0,P.Z)((0,P.Z)({},e),{},{background:a.fields.inputBackground,boxShadow:"none",cursor:"text",padding:0,minHeight:34}),menu:()=>({marginTop:8}),menuList:e=>(0,P.Z)((0,P.Z)({},e),{},{padding:0}),placeholder:e=>(0,P.Z)((0,P.Z)({},e),{},{color:a.fields.inputPlaceholder})}),[a]);return(0,n.tZ)(L.ZP,(0,i.Z)({backspaceRemovesValue:!1,captureMenuScroll:!1,closeMenuOnSelect:!1,controlShouldRenderValue:!1,hideSelectedOptions:!1,isClearable:!1,isSearchable:!0,maxMenuHeight:1e3,menuIsOpen:!0,menuShouldScrollIntoView:!1,styles:s,tabSelectsValue:!1,components:o},l))};l(7729);var j=l(3478),D=l(5291);let B=["tone","weight","onClick","tabIndex"],E=["weight","tone","containerProps","children","onClick","onRemove"],_=(0,r.forwardRef)((e,t)=>{let{tone:l,weight:r,onClick:o,tabIndex:a}=e,s=(0,N.Z)(e,B),{radii:d,spacing:u,tones:c,typography:g}=(0,n.Fg)(),p=!!o,f=c[l],m={bold:{background:f.fill[0],foreground:f.fillForeground[0],focus:{shadow:`0 0 0 2px ${f.focusRing}`},hover:{background:f.fill[1]},active:{background:f.fill[2]}},light:{background:f.tint[0],foreground:f.foreground[0],focus:{shadow:`0 0 0 2px ${f.focusRing}`},hover:{foreground:f.foreground[1],background:f.tint[1]},active:{foreground:f.foreground[2],background:f.tint[2]}}}[r],h={alignItems:"center",appearance:"none",background:"none",backgroundColor:m.background,border:0,color:m.foreground,display:"flex",fontSize:g.fontSize.small,fontWeight:g.fontWeight.medium,justifyContent:"center",maxWidth:"100%",minWidth:1,outline:0,padding:`${u.small}px ${u.medium}px`,":first-of-type":{paddingRight:u.small,borderTopLeftRadius:d.full,borderBottomLeftRadius:d.full,marginRight:1},":last-of-type":{paddingLeft:u.small,borderTopRightRadius:d.full,borderBottomRightRadius:d.full},":only-of-type":{paddingLeft:u.medium,paddingRight:u.medium}},b=p?{cursor:"pointer",":focus":{boxShadow:m.focus.shadow},":hover,:focus":{backgroundColor:m.hover.background,color:m.hover.foreground},":active":{backgroundColor:m.active.background,color:m.active.foreground}}:{};return(0,n.tZ)("button",(0,i.Z)({ref:t,css:(0,P.Z)((0,P.Z)({},h),b),onClick:o,tabIndex:p?a:-1},s))}),W=(0,r.forwardRef)((e,t)=>{let{weight:l="bold",tone:r="active",containerProps:o,children:a,onClick:s,onRemove:d}=e,u=(0,N.Z)(e,E);return(0,n.tZ)("div",(0,i.Z)({css:{display:"flex"}},o),(0,n.tZ)(_,(0,i.Z)({ref:t,weight:l,tone:r,onClick:s},u),a),d?(0,n.tZ)(_,{"aria-label":"remove pill",weight:l,tone:r,onClick:d},(0,n.tZ)(D.b,{css:{height:14,width:14}})):null)});l(6819),l(4002),l(9393),l(7668),l(1168),l(5976),l(581),l(6763),l(3900),l(8360);let getPaginationStats=({list:e,pageSize:t,currentPage:l,total:i})=>{let r="";if(i>t){let o=t*(l-1)+1;r=`${o} - ${Math.min(o+t-1,i)} of ${i} ${e.plural}`}else i>1&&e.plural?r=`${i} ${e.plural}`:1===i&&e.singular&&(r=`${i} ${e.singular}`);return{stats:r}};function Pagination({currentPage:e,total:t,pageSize:l,list:i}){let{query:o,pathname:s,push:d}=(0,v.useRouter)(),{stats:u}=getPaginationStats({list:i,currentPage:e,total:t,pageSize:l}),{opacity:c}=(0,n.Fg)(),g=e+1,p=e-1,f={...o,page:g},m={...o,page:p},h=Math.ceil(t/l),b=[];if((0,r.useEffect)(()=>{e>Math.ceil(t/l)&&d({pathname:s,query:{...o,page:Math.ceil(t/l)}})},[t,l,e,s,o,d]),t<=l)return null;for(let e=1;e<=h;e++)b.push({label:String(e),value:String(e)});return(0,n.tZ)(n.Kq,{as:"nav",role:"navigation","aria-label":"Pagination",paddingLeft:"medium",paddingRight:"medium",paddingTop:"large",paddingBottom:"large",across:!0,align:"center",css:{width:"100%",justifyContent:"space-between"}},(0,n.tZ)(n.Kq,{across:!0,gap:"xxlarge",align:"center"},(0,n.tZ)("span",null,`${i.plural} per page: ${l}`),(0,n.tZ)("span",null,(0,n.tZ)("strong",null,u))),(0,n.tZ)(n.Kq,{gap:"medium",across:!0,align:"center"},(0,n.tZ)(a.Ph,{width:"medium",value:{label:String(e),value:String(e)},options:b,styles:{valueContainer:e=>({...e,paddingLeft:"12px",paddingRight:"16px"})},menuPortalTarget:document.body,onChange:e=>{d({pathname:s,query:{...o,page:e.value}})}}),(0,n.tZ)("span",null,"of ",h),(0,n.tZ)(C.rU,{"aria-label":"Previous page",css:{color:"#415269",...p<1&&{pointerEvents:"none",opacity:c.disabled}},href:{query:m}},(0,n.tZ)($.wyc,null)),(0,n.tZ)(C.rU,{"aria-label":"Next page",css:{color:"#415269",...g>h&&{pointerEvents:"none",opacity:c.disabled}},href:{query:f}},(0,n.tZ)($.XCv,null))))}function PaginationLabel({currentPage:e,pageSize:t,plural:l,singular:i,total:r}){let{stats:o}=getPaginationStats({list:{plural:l,singular:i},currentPage:e,total:r,pageSize:t});return r?(0,n.tZ)("span",null,"Showing ",(0,n.tZ)("strong",null,o)):(0,n.tZ)("span",null,"No ",l)}function useSelectedFields(e,t){let{query:l}=(0,v.useRouter)(),i="string"==typeof l.fields?l.fields:"";return(0,r.useMemo)(()=>{let l=(i?i.split(","):e.initialColumns).filter(e=>"read"===t[e]);return new Set(0===l.length?[e.labelField]:l)},[e,i,t])}let H={Option:e=>(0,n.tZ)(OptionPrimitive,e,e.children,(0,n.tZ)(CheckMark,{isDisabled:e.isDisabled,isFocused:e.isFocused,isSelected:e.isSelected}))};function FieldSelection({list:e,fieldModesByFieldPath:t}){let l=(0,v.useRouter)(),r=useSelectedFields(e,t),setNewSelectedFields=t=>{if(function(e,t){if(e.length!==t.length)return!1;for(let l=0;l<e.length;l++)if(e[l]!==t[l])return!1;return!0}(t,e.initialColumns)){let{fields:e,...t}=l.query;l.push({query:t})}else l.push({query:{...l.query,fields:t.join(",")}})},a=[];return Object.keys(t).forEach(l=>{"read"===t[l]&&a.push({value:l,label:e.fields[l].label,isDisabled:1===r.size&&r.has(l)})}),(0,n.tZ)(k.J2,{"aria-label":`Columns options, list of column options to apply to the ${e.key} list`,triggerRenderer:({triggerProps:e})=>(0,n.tZ)(o.zx,(0,i.Z)({weight:"link",css:{padding:4}},e),(0,n.tZ)("span",{css:{display:"inline-flex",justifyContent:"center",alignItems:"center"}},r.size," column",1===r.size?"":"s"," ",(0,n.tZ)(I.v,{size:"smallish"})))},(0,n.tZ)("div",{css:{width:320}},(0,n.tZ)(n.xu,{padding:"medium"},(0,n.tZ)(Options,{onChange:e=>{Array.isArray(e)&&setNewSelectedFields(e.map(e=>e.value))},isMulti:!0,value:a.filter(e=>r.has(e.value)),options:a,components:H}))))}let A={Option:({children:e,...t})=>{let l=(0,n.Fg)(),i=t.isFocused?l.colors.foreground:l.colors.foregroundDim;return(0,n.tZ)(OptionPrimitive,t,(0,n.tZ)("span",null,e),(0,n.tZ)("div",{css:{alignItems:"center",display:"flex",height:24,justifyContent:"center",width:24}},(0,n.tZ)(S.X,{css:{color:i}})))}};function FilterAdd({listKey:e,filterableFields:t}){let{isOpen:l,setOpen:a,trigger:s,dialog:d,arrow:u}=(0,k.Sv)({placement:"bottom",modifiers:[{name:"offset",options:{offset:[0,8]}}]});return(0,n.tZ)(r.Fragment,null,(0,n.tZ)(o.zx,(0,i.Z)({tone:"active"},s.props,{ref:s.ref,onClick:()=>a(!l)}),(0,n.tZ)(n.xu,{as:"span",marginRight:"xsmall"},"Filter List"),(0,n.tZ)(I.v,{size:"small"})),(0,n.tZ)(k.c1,(0,i.Z)({"aria-label":`Filters options, list of filters to apply to the ${e} list`,arrow:u,isVisible:l},d.props,{ref:d.ref}),l&&(0,n.tZ)(FilterAddPopoverContent,{onClose:()=>{a(!1)},listKey:e,filterableFields:t})))}function FilterAddPopoverContent({onClose:e,listKey:t,filterableFields:l}){let i=(0,y.sm)(t),s=(0,v.useRouter)(),d=(0,r.useMemo)(()=>{let e={};return Object.keys(i.fields).forEach(t=>{let r=i.fields[t];l.has(t)&&r.controller.filter&&(e[t]=r)}),e},[i.fields,l]),u=(0,r.useMemo)(()=>{let e={};return Object.keys(d).forEach(t=>{let l=d[t],i=!1,r={};Object.keys(l.controller.filter.types).forEach(e=>{void 0===s.query[`!${t}_${e}`]&&(i=!0,r[e]=l.controller.filter.types[e].label)}),i&&(e[t]=r)}),e},[s.query,d]),[c,g]=(0,r.useState)({kind:"selecting-field"});return(0,n.tZ)(n.Kq,{padding:"medium",as:"form",css:{minWidth:320},onSubmit:t=>{t.preventDefault(),"filter-value"===c.kind&&(s.push({query:{...s.query,[`!${c.fieldPath}_${c.filterType}`]:JSON.stringify(c.filterValue)}}),e())},gap:"small"},(0,n.tZ)("div",{css:{position:"relative"}},"selecting-field"!==c.kind&&(0,n.tZ)("button",{type:"button",onClick:()=>{g({kind:"selecting-field"})},css:{border:0,background:"transparent",cursor:"pointer",position:"absolute"}},(0,n.tZ)(n.TX,null,"Back"),(0,n.tZ)(j.w,{size:"smallish"})),(0,n.tZ)(n.X6,{textAlign:"center",type:"h5"},(()=>{switch(c.kind){case"selecting-field":return"Filter";case"filter-value":return i.fields[c.fieldPath].label}})())),(0,n.tZ)(n.iz,null),"selecting-field"===c.kind&&(0,n.tZ)(Options,{components:A,onChange:e=>{let t=e.value,l=Object.keys(u[t])[0];g({kind:"filter-value",fieldPath:t,filterType:l,filterValue:d[t].controller.filter.types[l].initialValue})},options:Object.keys(u).map(e=>({label:d[e].label,value:e}))}),"filter-value"===c.kind&&(0,n.tZ)(a.Ph,{width:"full",value:{value:c.filterType,label:u[c.fieldPath][c.filterType]},onChange:e=>{e&&g({kind:"filter-value",fieldPath:c.fieldPath,filterValue:d[c.fieldPath].controller.filter.types[e.value].initialValue,filterType:e.value})},options:Object.keys(u[c.fieldPath]).map(e=>({label:u[c.fieldPath][e],value:e}))}),"filter-value"==c.kind&&(()=>{let{Filter:e}=d[c.fieldPath].controller.filter;return(0,n.tZ)(e,{type:c.filterType,value:c.filterValue,onChange:e=>{g(t=>({...t,filterValue:e}))}})})(),"filter-value"==c.kind&&(0,n.tZ)("div",{css:{display:"flex",justifyContent:"space-between"}},(0,n.tZ)(o.zx,{onClick:e},"Cancel"),(0,n.tZ)(o.zx,{type:"submit"},"Apply")))}function FilterList({filters:e,list:t}){return(0,n.tZ)(n.gF,{gap:"small"},e.map(e=>{let l=t.fields[e.field];return(0,n.tZ)(FilterPill,{key:`${e.field}_${e.type}`,field:l,filter:e})}))}function FilterPill({filter:e,field:t}){let l=(0,v.useRouter)(),{isOpen:o,setOpen:a,trigger:s,dialog:d,arrow:u}=(0,k.Sv)({placement:"bottom",modifiers:[{name:"offset",options:{offset:[0,8]}}]}),c=t.controller.filter.Label;return(0,n.tZ)(r.Fragment,null,(0,n.tZ)(W,(0,i.Z)({containerProps:{"aria-label":`Filter item ${e.field}, press to edit filter`}},s.props,{ref:s.ref,onClick:()=>a(!o),weight:"light",tone:"passive",onRemove:()=>{let{[`!${e.field}_${e.type}`]:t,...i}=l.query;l.push({pathname:l.pathname,query:i})}}),t.label," ",(0,n.tZ)(c,{label:t.controller.filter.types[e.type].label,type:e.type,value:e.value})),(0,n.tZ)(k.c1,(0,i.Z)({"aria-label":`filter item config, dialog for configuring ${e.field} filter`,arrow:u},d.props,{isVisible:o,ref:d.ref}),o&&(0,n.tZ)(EditDialog,{onClose:()=>{a(!1)},field:t,filter:e})))}function EditDialog({filter:e,field:t,onClose:l}){let i=t.controller.filter.Filter,a=(0,v.useRouter)(),[s,d]=(0,r.useState)(e.value);return(0,n.tZ)(n.Kq,{as:"form",padding:"small",gap:"small",onSubmit:t=>{t.preventDefault(),a.push({query:{...a.query,[`!${e.field}_${e.type}`]:JSON.stringify(s)}}),l()}},(0,n.tZ)(i,{type:e.type,value:s,onChange:d}),(0,n.tZ)("div",{css:{display:"flex",justifyContent:"space-between"}},(0,n.tZ)(o.zx,{onClick:l},"Cancel"),(0,n.tZ)(o.zx,{type:"submit"},"Save")))}function useSort(e,t){let{query:l}=(0,v.useRouter)(),i="string"==typeof l.sortBy?l.sortBy:null;return(0,r.useMemo)(()=>{if(""===i)return null;if(null===i)return e.initialSort;if(i.startsWith("-")){let e=i.slice(1);return t.has(e)?{field:e,direction:"DESC"}:null}return t.has(i)?{field:i,direction:"ASC"}:null},[i,e,t])}function SortSelection({list:e,orderableFields:t}){let l=useSort(e,t),{isOpen:a,setOpen:s,trigger:d,dialog:u,arrow:c}=(0,k.Sv)({placement:"bottom",modifiers:[{name:"offset",options:{offset:[0,8]}}]});return(0,n.tZ)(r.Fragment,null,(0,n.tZ)(o.zx,(0,i.Z)({},d.props,{weight:"link",css:{padding:4},ref:d.ref,onClick:()=>s(!a)}),(0,n.tZ)("span",{css:{display:"inline-flex",justifyContent:"center",alignItems:"center"}},l?`${e.fields[l.field].label} ${({ASC:"ascending",DESC:"descending"})[l.direction]}`:"No field",(0,n.tZ)(I.v,{size:"smallish"}))),(0,n.tZ)(k.c1,(0,i.Z)({"aria-label":`Sort options, list of sorting parameters to apply to the ${e.key} list`,arrow:c,isVisible:a},u.props,{ref:u.ref}),a&&(0,n.tZ)(SortSelectionPopoverContent,{onClose:()=>{s(!1)},list:e,orderableFields:t})))}let V={label:"No field",value:"___________NO_FIELD___________"};function SortSelectionPopoverContent({onClose:e,list:t,orderableFields:l}){let i=useSort(t,l),r=(0,v.useRouter)();return(0,n.tZ)(n.Kq,{padding:"medium",css:{minWidth:320},gap:"small"},(0,n.tZ)("div",{css:{position:"relative"}},(0,n.tZ)(n.X6,{textAlign:"center",type:"h5"},"Sort")),(0,n.tZ)(n.iz,null),(0,n.tZ)(Options,{value:i?{label:t.fields[i.field].label,value:i.field}:V,components:H,onChange:l=>{let o=l.value;if(o===V.value){let{sortBy:e,...l}=r.query;t.initialSort?r.push({query:{...r.query,sortBy:""}}):r.push({query:l})}else r.push({query:{...r.query,sortBy:(null==i?void 0:i.field)===o&&"ASC"===i.direction?`-${i.field}`:o}});e()},options:[...l].map(e=>({label:t.fields[e].label,value:e})).concat(V)}))}let K=m.Ps`
  query ($listKey: String!) {
    keystone {
      adminMeta {
        list(key: $listKey) {
          hideDelete
          hideCreate
          fields {
            path
            isOrderable
            isFilterable
            listView {
              fieldMode
            }
          }
        }
      }
    }
  }
`,U=["sortBy","fields"],getListPage=e=>()=>(0,n.tZ)(ListPage,e),ListPage=({listKey:e})=>{var t,l,i;let s=(0,y.sm)(e),{query:u,push:c}=(0,v.useRouter)(),{resetToDefaults:f}=function(e){let t=(0,v.useRouter)(),l=`keystone.list.${e}.list.page.info`;return(0,r.useEffect)(()=>{if(!Object.keys(t.query).some(e=>e.startsWith("!")||U.includes(e))&&t.isReady){let e;let i=localStorage.getItem(l);try{e=JSON.parse(i)}catch(e){}e&&t.replace({query:{...t.query,...e}})}},[l,t.isReady]),(0,r.useEffect)(()=>{let e={};Object.keys(t.query).forEach(l=>{(l.startsWith("!")||U.includes(l))&&(e[l]=t.query[l])}),Object.keys(e).length?localStorage.setItem(l,JSON.stringify(e)):localStorage.removeItem(l)},[l,t]),{resetToDefaults:()=>{localStorage.removeItem(l),t.replace({pathname:t.pathname})}}}(e),b="string"!=typeof u.page||Number.isNaN(parseInt(u.page))?1:Number(u.page),Z="string"!=typeof u.pageSize||Number.isNaN(parseInt(u.pageSize))?s.pageSize:parseInt(u.pageSize),k=(0,h.a)(K,{variables:{listKey:e}}),{listViewFieldModesByField:S,filterableFields:C,orderableFields:$}=(0,r.useMemo)(()=>{let e={},t=new Set,l=new Set;for(let r of(null===(i=k.data)||void 0===i||null===(i=i.keystone.adminMeta.list)||void 0===i?void 0:i.fields)||[]){var i;e[r.path]=r.listView.fieldMode,r.isOrderable&&t.add(r.path),r.isFilterable&&l.add(r.path)}return{listViewFieldModesByField:e,orderableFields:t,filterableFields:l}},[null===(t=k.data)||void 0===t||null===(t=t.keystone.adminMeta.list)||void 0===t?void 0:t.fields]),I=useSort(s,$),P=function(e,t){let{query:l}=(0,v.useRouter)(),i=(0,r.useMemo)(()=>{let l={};return Object.entries(e.fields).forEach(([e,i])=>{i.controller.filter&&t.has(e)&&Object.keys(i.controller.filter.types).forEach(t=>{l[`!${e}_${t}`]={type:t,field:e}})}),l},[e,t]),o=(0,r.useMemo)(()=>{let t=[];Object.keys(l).forEach(e=>{let r=i[e],o=l[e];if(r&&"string"==typeof o){let e;try{e=JSON.parse(o)}catch(e){}void 0!==o&&t.push({...r,value:e})}});let r=t.reduce((t,l)=>Object.assign(t,e.fields[l.field].controller.filter.graphql({type:l.type,value:l.value})),{});return e.isSingleton?{filters:t,where:{id:{equals:1},AND:[r]}}:{filters:t,where:r}},[l,i,e]);return o}(s,C),N=Object.keys(s.fields).filter(e=>s.fields[e].search),z=N.map(e=>s.fields[e].label),q="string"==typeof u.search?u.search:"",[L,M]=(0,r.useState)(q),O=(0,F.L)(q,s,N),updateSearch=e=>{let{search:t,...l}=u;e.trim()?c({query:{...l,search:e}}):c({query:l})},T=useSelectedFields(s,S),{data:j,error:D,refetch:B}=(0,h.a)((0,r.useMemo)(()=>{let e=[...T].map(e=>s.fields[e].controller.graphqlSelection).join("\n");return m.Ps`
      query ($where: ${s.gqlNames.whereInputName}, $take: Int!, $skip: Int!, $orderBy: [${s.gqlNames.listOrderName}!]) {
        items: ${s.gqlNames.listQueryName}(where: $where, take: $take, skip: $skip, orderBy: $orderBy) {
          ${T.has("id")?"":"id"}
          ${e}
        }
        count: ${s.gqlNames.listQueryCountName}(where: $where)
      }
    `},[s,T]),{fetchPolicy:"cache-and-network",errorPolicy:"all",skip:!k.data,variables:{where:{...P.where,...O},take:Z,skip:(b-1)*Z,orderBy:I?[{[I.field]:I.direction.toLowerCase()}]:void 0}}),[E,_]=(0,r.useState)({data:j,error:D});j&&E.data!==j&&_({data:j,error:D});let{data:W,error:H}=E,A=(0,p.m)(W,null==H?void 0:H.graphQLErrors),[V,X]=(0,r.useState)(()=>({itemsFromServer:void 0,selectedItems:new Set}));if(W&&W.items&&V.itemsFromServer!==W.items){let e=new Set;W.items.forEach(t=>{V.selectedItems.has(t.id)&&e.add(t.id)}),X({itemsFromServer:W.items,selectedItems:e})}let J=(0,n.Fg)(),Q=!(null===(l=null===(i=k.data)||void 0===i||null===(i=i.keystone.adminMeta.list)||void 0===i?void 0:i.hideCreate)||void 0===l||l)||null;return(0,n.tZ)(x.P,{header:(0,n.tZ)(ListPageHeader,{listKey:e}),title:s.label},null!=H&&H.graphQLErrors.length||null!=H&&H.networkError?(0,n.tZ)(w.G,{errors:null==H?void 0:H.graphQLErrors,networkError:null==H?void 0:H.networkError}):null,k.error?"Error...":null,W&&k.data?(0,n.tZ)(r.Fragment,null,null!==s.description&&(0,n.tZ)("p",{css:{marginTop:"24px",maxWidth:"704px"}},s.description),(0,n.tZ)(n.Kq,{across:!0,gap:"medium",align:"center",marginTop:"xlarge"},(0,n.tZ)("form",{onSubmit:e=>{e.preventDefault(),updateSearch(L)}},(0,n.tZ)(n.Kq,{across:!0},(0,n.tZ)(a.oi,{css:{borderRadius:"4px 0px 0px 4px"},autoFocus:!0,value:L,onChange:e=>M(e.target.value),placeholder:`Search by ${z.length?z.join(", "):"ID"}`}),(0,n.tZ)(o.zx,{css:{borderRadius:"0px 4px 4px 0px"},type:"submit"},(0,n.tZ)(g.W,null)))),Q&&(0,n.tZ)(R.C,{list:s}),W.count||P.filters.length?(0,n.tZ)(FilterAdd,{listKey:e,filterableFields:C}):null,P.filters.length?(0,n.tZ)(FilterList,{filters:P.filters,list:s}):null,!!(P.filters.length||void 0!==u.sortBy||u.fields||u.search)&&(0,n.tZ)(o.zx,{size:"small",onClick:f},"Reset to defaults")),W.count?(0,n.tZ)(r.Fragment,null,(0,n.tZ)(ResultsSummaryContainer,null,(()=>{let e=V.selectedItems,t=e.size;if(t){var l,i;return(0,n.tZ)(r.Fragment,null,(0,n.tZ)("span",{css:{marginRight:J.spacing.small}},"Selected ",t," of ",W.items.length),!(null===(l=null===(i=k.data)||void 0===i||null===(i=i.keystone.adminMeta.list)||void 0===i?void 0:i.hideDelete)||void 0===l||l)&&(0,n.tZ)(DeleteManyButton,{list:s,selectedItems:e,refetch:B}))}return(0,n.tZ)(r.Fragment,null,(0,n.tZ)(PaginationLabel,{currentPage:b,pageSize:Z,plural:s.plural,singular:s.singular,total:W.count}),", sorted by ",(0,n.tZ)(SortSelection,{list:s,orderableFields:$}),"with"," ",(0,n.tZ)(FieldSelection,{list:s,fieldModesByFieldPath:S})," ")})()),(0,n.tZ)(ListTable,{count:W.count,currentPage:b,itemsGetter:A.get("items"),listKey:e,pageSize:Z,selectedFields:T,sort:I,selectedItems:V.selectedItems,onSelectedItemsChange:e=>{X({itemsFromServer:V.itemsFromServer,selectedItems:e})},orderableFields:$})):(0,n.tZ)(ResultsSummaryContainer,null,"No ",s.plural," found.")):(0,n.tZ)(n.M5,{css:{height:`calc(100vh - ${x.H}px)`}},(0,n.tZ)(d.xg,{label:"Loading item data",size:"large",tone:"passive"})))},ListPageHeader=({listKey:e})=>{let t=(0,y.sm)(e);return(0,n.tZ)(r.Fragment,null,(0,n.tZ)("div",{css:{alignItems:"center",display:"flex",flex:1,justifyContent:"space-between"}},(0,n.tZ)(n.X6,{type:"h3"},t.label)))},ResultsSummaryContainer=({children:e})=>(0,n.tZ)("p",{css:{minHeight:38,display:"flex",alignItems:"center"}},e),SortDirectionArrow=({direction:e})=>{let t="0.25em";return(0,n.tZ)("span",{css:{borderLeft:`${t} solid transparent`,borderRight:`${t} solid transparent`,borderTop:`${t} solid`,display:"inline-block",height:0,marginLeft:"0.33em",marginTop:"-0.125em",verticalAlign:"middle",width:0,transform:`rotate(${"DESC"===e?"0deg":"180deg"})`}})};function DeleteManyButton({selectedItems:e,list:t,refetch:l}){let[i,a]=(0,b.D)((0,r.useMemo)(()=>m.Ps`
        mutation($where: [${t.gqlNames.whereUniqueInputName}!]!) {
          ${t.gqlNames.deleteManyMutationName}(where: $where) {
            id
            ${t.labelField}
          }
        }
`,[t]),{errorPolicy:"all"}),[s,d]=(0,r.useState)(!1),g=(0,c.e)();return(0,n.tZ)(r.Fragment,null,(0,n.tZ)(o.zx,{isLoading:a.loading,tone:"negative",onClick:async()=>{d(!0)}},"Delete"),(0,n.tZ)(u.aR,{isOpen:s,title:"Delete Confirmation",tone:"negative",actions:{confirm:{label:"Delete",action:async()=>{let{data:r,errors:o}=await i({variables:{where:[...e].map(e=>({id:e}))}}),{successfulItems:n,unsuccessfulItems:a,successMessage:s}=r[t.gqlNames.deleteManyMutationName].reduce((e,l)=>(l?(e.successfulItems++,e.successMessage=""===e.successMessage?e.successMessage+=l[t.labelField]:e.successMessage+=`, ${l[t.labelField]}`):e.unsuccessfulItems++,e),{successfulItems:0,unsuccessfulItems:0,successMessage:""});return null!=o&&o.length&&g.addToast({tone:"negative",title:`Failed to delete ${a} of ${r[t.gqlNames.deleteManyMutationName].length} ${t.plural}`,message:o.reduce((e,t)=>(0>e.indexOf(t.message)&&e.push(t.message),e),[]).join("\n")}),n&&g.addToast({tone:"positive",title:`Deleted ${n} of ${r[t.gqlNames.deleteManyMutationName].length} ${t.plural} successfully`,message:s}),l()}},cancel:{label:"Cancel",action:()=>{d(!1)}}}},"Are you sure you want to delete ",e.size," ",1===e.size?t.singular:t.plural,"?"))}function ListTable({selectedFields:e,listKey:t,itemsGetter:l,count:i,sort:r,currentPage:o,pageSize:d,selectedItems:u,onSelectedItemsChange:c,orderableFields:g}){var p,m;let h=(0,y.sm)(t),{query:b}=(0,v.useRouter)(),k=!h.fields[e.keys().next().value].views.Cell.supportsLinkTo;return(0,n.tZ)(n.xu,{paddingBottom:"xlarge"},(0,n.tZ)(TableContainer,null,(0,n.tZ)(n.TX,{as:"caption"},h.label," list"),(0,n.tZ)("colgroup",null,(0,n.tZ)("col",{width:"30"}),k&&(0,n.tZ)("col",{width:"30"}),[...e].map(e=>(0,n.tZ)("col",{key:e}))),(0,n.tZ)(TableHeaderRow,null,(0,n.tZ)(TableHeaderCell,{css:{paddingLeft:0}},(0,n.tZ)("label",{css:{display:"flex",alignItems:"center",justifyContent:"start",cursor:"pointer"}},(0,n.tZ)(a.Z8,{size:"small",checked:u.size===(null===(p=l.data)||void 0===p?void 0:p.length),css:{cursor:"default"},onChange:()=>{var e,t;let i=new Set;u.size!==(null===(e=l.data)||void 0===e?void 0:e.length)&&(null===(t=l.data)||void 0===t||t.forEach(e=>{null!==e&&null!==e.id&&i.add(e.id)})),c(i)}}))),k&&(0,n.tZ)(TableHeaderCell,null),[...e].map(e=>{let t=h.fields[e].label;return g.has(e)?(0,n.tZ)(TableHeaderCell,{key:e},(0,n.tZ)(C.rU,{css:{display:"block",textDecoration:"none",color:"inherit",":hover":{color:"inherit"}},href:{query:{...b,sortBy:(null==r?void 0:r.field)===e&&"ASC"===r.direction?`-${e}`:e}}},t,(null==r?void 0:r.field)===e&&(0,n.tZ)(SortDirectionArrow,{direction:r.direction}))):(0,n.tZ)(TableHeaderCell,{key:e},t)})),(0,n.tZ)("tbody",null,(null!==(m=l.data)&&void 0!==m?m:[]).map((t,i)=>{let r=l.get(i);if(null===r.data||null===r.data.id)return r.errors?(0,n.tZ)("tr",{css:{color:"red"},key:`index:${i}`},r.errors[0].message):null;let o=r.data.id;return(0,n.tZ)("tr",{key:o||`index:${i}`},(0,n.tZ)(TableBodyCell,null,(0,n.tZ)("label",{css:{display:"flex",minHeight:38,alignItems:"center",justifyContent:"start"}},(0,n.tZ)(a.Z8,{size:"small",checked:u.has(o),css:{cursor:"default"},onChange:()=>{let e=new Set(u);u.has(o)?e.delete(o):e.add(o),c(e)}}))),k&&(0,n.tZ)(TableBodyCell,null,(0,n.tZ)(C.rU,{css:{textDecoration:"none",minHeight:38,display:"flex",alignItems:"center",justifyContent:"center"},href:`/${h.path}/[id]`,as:`/${h.path}/${encodeURIComponent(o)}`},(0,n.tZ)(s.M,{size:"smallish","aria-label":"Go to item"}))),[...e].map((e,t)=>{let l=h.fields[e],{Cell:i}=h.fields[e].views,a={};for(let s of(0,f.g)(l.controller)){let l=r.get(s);if(l.errors){let r=l.errors[0].message;return(0,n.tZ)(TableBodyCell,{css:{color:"red"},key:e},0===t&&i.supportsLinkTo?(0,n.tZ)(Z.C,{href:`/${h.path}/[id]`,as:`/${h.path}/${encodeURIComponent(o)}`},r):r)}a[s]=l.data}return(0,n.tZ)(TableBodyCell,{key:e},(0,n.tZ)(i,{field:l.controller,item:a,linkTo:0===t&&i.supportsLinkTo?{href:`/${h.path}/[id]`,as:`/${h.path}/${encodeURIComponent(o)}`}:void 0}))}))}))),(0,n.tZ)(Pagination,{list:h,total:i,currentPage:o,pageSize:d}))}let TableContainer=({children:e})=>(0,n.tZ)("table",{css:{minWidth:"100%",tableLayout:"fixed","tr:last-child td":{borderBottomWidth:0}},cellPadding:"0",cellSpacing:"0"},e),TableHeaderRow=({children:e})=>(0,n.tZ)("thead",null,(0,n.tZ)("tr",null,e)),TableHeaderCell=e=>{let{colors:t,spacing:l,typography:r}=(0,n.Fg)();return(0,n.tZ)("th",(0,i.Z)({css:{backgroundColor:t.background,borderBottom:`2px solid ${t.border}`,color:t.foregroundDim,fontSize:r.fontSize.medium,fontWeight:r.fontWeight.medium,padding:l.small,textAlign:"left",position:"sticky",top:0}},e))},TableBodyCell=e=>{let{colors:t,typography:l}=(0,n.Fg)();return(0,n.tZ)("td",(0,i.Z)({css:{borderBottom:`1px solid ${t.border}`,fontSize:l.fontSize.medium}},e))}},7035:function(e,t,l){l.d(t,{C:function(){return CreateButtonLink}});var i=l(5631),r=l(5445),o=l(1511);function CreateButtonLink(e){return(0,r.tZ)(i.zx,{css:{textDecoration:"none",":hover":{color:"white"}},as:o.rU,href:`/${e.list.path}/create`,tone:"active",size:"small",weight:"bold"},"Create ",e.list.singular)}},8023:function(e,t,l){l.d(t,{H:function(){return p},P:function(){return PageContainer}});var i=l(7896),r=l(5445),o=l(2784),n=l(3818),a=l(5632);l(5631),l(487),l(891),l(5273);var s=l(5360),d=l(1511),u=l(6987),c=l(9097),g=l.n(c);let Logo=()=>{var e;let{spacing:t}=(0,r.Fg)(),{adminConfig:l}=(0,s.jf)();return null!==(e=l.components)&&void 0!==e&&e.Logo?(0,r.tZ)(l.components.Logo,null):(0,r.tZ)(r.H3,null,(0,r.tZ)(g(),{href:"/",css:{backgroundImage:"linear-gradient(to right, #0ea5e9, #6366f1)",backgroundClip:"text",lineHeight:"1.75rem",color:"transparent",verticalAlign:"middle",transition:"color 0.3s ease",textDecoration:"none"}},(0,r.tZ)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 220 220",css:{display:"inline-block",width:"2rem",height:"2rem",margin:`0  ${t.medium}px ${t.xsmall}px 0`,verticalAlign:"middle"}},(0,r.tZ)("defs",null,(0,r.tZ)("linearGradient",{id:"logo-a",x1:"0%",x2:"50%",y1:"0%",y2:"71.9%"},(0,r.tZ)("stop",{offset:"0%",stopColor:"#5AE8FA"}),(0,r.tZ)("stop",{offset:"100%",stopColor:"#2684FF"}))),(0,r.tZ)("path",{fill:"url(#logo-a)",fillRule:"evenodd",d:"M290.1 47h117.5c17.8 0 24.3 1.9 30.8 5.3a36.3 36.3 0 0115.1 15.2c3.5 6.5 5.4 13 5.4 30.8v117.4c0 17.9-1.9 24.3-5.4 30.8a36.3 36.3 0 01-15.1 15.2c-6.5 3.4-13 5.3-30.8 5.3H290c-17.8 0-24.3-1.9-30.8-5.3a36.3 36.3 0 01-15.1-15.2c-3.5-6.5-5.3-13-5.3-30.8V98.3c0-17.9 1.8-24.3 5.3-30.8a36.3 36.3 0 0115.1-15.2c6.5-3.4 13-5.3 30.8-5.3zm11.8 56.8V218H327v-36.8l14.4-14.6 34.4 51.4h31.5l-49-69.1 44.7-45.1h-31.3L327 151v-47.3H302z",transform:"translate(-238.9 -47)"})),"Keystone 6"))},NavItem=({href:e,children:t,isSelected:l})=>{let{colors:i,palette:o,spacing:n,radii:s,typography:u}=(0,r.Fg)(),c=(0,a.useRouter)(),g=void 0!==l?l:c.pathname===e;return(0,r.tZ)("li",null,(0,r.tZ)(d.rU,{"aria-current":!!g&&"location",href:e,css:{background:"transparent",borderBottomRightRadius:s.xsmall,borderTopRightRadius:s.xsmall,color:o.neutral700,display:"block",fontWeight:u.fontWeight.medium,marginBottom:n.xsmall,marginRight:n.xlarge,padding:`${n.small}px ${n.xlarge}px`,position:"relative",textDecoration:"none",":hover":{background:i.backgroundHover,color:i.linkHoverColor},"&[aria-current=location]":{background:o.neutral200,color:o.neutral900}}},t))},AuthenticatedItemDialog=({item:e})=>{let{apiPath:t}=(0,s.jf)(),{spacing:l,typography:i}=(0,r.Fg)();return(0,r.tZ)("div",{css:{alignItems:"center",display:"flex",flexDirection:"row",justifyContent:"space-between",margin:l.xlarge,marginBottom:0}},!!e&&"authenticated"===e.state&&(0,r.tZ)("div",{css:{fontSize:i.fontSize.small}},"Signed in as ",(0,r.tZ)("strong",{css:{display:"block"}},e.label)),e&&"authenticated"===e.state&&(0,r.tZ)(u.S,null))},NavigationContainer=({authenticatedItem:e,children:t})=>{let{spacing:l}=(0,r.Fg)();return(0,r.tZ)("div",{css:{display:"flex",flexDirection:"column",justifyContent:"center",position:"relative"}},(0,r.tZ)(AuthenticatedItemDialog,{item:e}),(0,r.tZ)("nav",{role:"navigation","aria-label":"Side Navigation",css:{marginTop:l.xlarge}},(0,r.tZ)("ul",{css:{padding:0,margin:0,li:{listStyle:"none"}}},t)))},ListNavItem=({list:e})=>{let t=(0,a.useRouter)();return(0,r.tZ)(NavItem,{isSelected:t.pathname.split("/")[1]===`/${e.path}`.split("/")[1],href:`/${e.path}${e.isSingleton?"/1":""}`},e.label)},ListNavItems=({lists:e=[],include:t=[]})=>{let l=t.length>0?e.filter(e=>t.includes(e.key)):e;return(0,r.tZ)(o.Fragment,null,l.map(e=>(0,r.tZ)(ListNavItem,{key:e.key,list:e})))},Navigation=()=>{var e;let{adminMeta:{lists:t},adminConfig:l,authenticatedItem:i,visibleLists:o}=(0,s.jf)();if("loading"===o.state)return null;if("error"===o.state)return(0,r.tZ)(r.xv,{as:"span",paddingLeft:"xlarge",css:{color:"red"}},o.error instanceof Error?o.error.message:o.error[0].message);let n=Object.keys(t).map(e=>o.lists.has(e)?t[e]:null).filter(e=>!!e);return null!=l&&null!==(e=l.components)&&void 0!==e&&e.Navigation?(0,r.tZ)(l.components.Navigation,{authenticatedItem:i,lists:n}):(0,r.tZ)(NavigationContainer,{authenticatedItem:i},(0,r.tZ)(NavItem,{href:"/"},"Dashboard"),(0,r.tZ)(ListNavItems,{lists:n}))},p=80,PageWrapper=e=>(0,r.tZ)(o.Fragment,null,(0,r.tZ)("style",null,"body { overflow: hidden; }"),(0,r.tZ)("div",(0,i.Z)({css:{display:"grid",gridTemplateColumns:"minmax(300px, 1fr)",gridTemplateRows:`repeat(2,${p}px) auto`,height:"100vh",isolation:"isolate","@media (min-width: 576px)":{gridTemplateColumns:"minmax(300px, 1fr) 4fr",gridTemplateRows:`${p}px auto`}}},e))),Sidebar=({isSidebarOpen:e,...t})=>(0,r.tZ)("div",{css:{gridColumn:"1/2",gridRow:"2/4",display:e?"block":"none",height:"100vh","@media (min-width: 576px)":{gridColumn:"1/2",gridRow:"2/3",display:"block",height:"100%"},overflowY:"auto",WebkitOverflowScrolling:"touch"}},(0,r.tZ)("aside",(0,i.Z)({css:{minWidth:0,WebkitOverflowScrolling:"touch"}},t))),Content=e=>{let{colors:t,spacing:l}=(0,r.Fg)();return(0,r.tZ)("main",(0,i.Z)({css:{backgroundColor:t.background,boxSizing:"border-box",minWidth:0,paddingLeft:l.xlarge,paddingRight:l.xlarge,overflowY:"auto",WebkitOverflowScrolling:"touch",position:"relative"}},e))},PageContainer=({children:e,header:t,title:l})=>{let{colors:i,spacing:a}=(0,r.Fg)(),[s,d]=(0,o.useState)(!1);return(0,r.tZ)(PageWrapper,null,(0,r.tZ)("div",{css:{alignItems:"center",borderBottom:`1px solid ${i.border}`,display:"flex",justifyContent:"space-between",paddingLeft:a.xlarge,paddingRight:a.xlarge}},(0,r.tZ)(Logo,null),(0,r.tZ)("div",{onClick:()=>{d(!s)},css:{display:"block","@media (min-width: 576px)":{display:"none"}}},s?(0,r.tZ)(n.oOx,null):(0,r.tZ)(n.Oqj,null))),(0,r.tZ)("header",{css:{alignItems:"center",backgroundColor:i.background,borderBottom:`1px solid ${i.border}`,display:"flex",justifyContent:"space-between",minWidth:0,paddingLeft:a.xlarge,paddingRight:a.xlarge,visibility:s?"hidden":"visible"}},(0,r.tZ)("title",null,l?`Keystone - ${l}`:"Keystone"),(0,r.tZ)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),t),(0,r.tZ)(Sidebar,{isSidebarOpen:s},(0,r.tZ)(Navigation,null)),(0,r.tZ)(Content,null,e))}}}]);